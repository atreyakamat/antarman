---
import Layout from '../layouts/HomeLayout.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import ParticleBG from "../components/ParticleBG.astro";
import Marquee from "../components/ui/marquee";
import { getEntryBySlug } from 'astro:content';

const internImagesEntry = await getEntryBySlug('clinics', 'intern-images');
const internImages = internImagesEntry?.data.images || [];
---
<Layout title="Internship | Antarman">
    <ParticleBG />
    <Header />

    <main class="relative">
        <div class="absolute inset-0 bg-gradient-to-b from-purple-900/50 via-purple-800/30 to-transparent"></div>
        <div class="relative z-10">
            <div class="container mx-auto px-6 py-16 text-center md:py-20 lg:px-0 lg:py-28">
                <h1 class="text-5xl font-extrabold leading-tight text-white md:text-6xl lg:text-7xl animate-fade-in">
                    Internship
                </h1>
                <p class="mx-auto mt-6 max-w-3xl text-xl text-purple-100 md:text-2xl animate-slide-up">
                    Join Our Team and Make a Difference
                </p>
            </div>
        </div>
    </main>

    <div class="container mx-auto px-4">
        <!-- Metadata Section -->
        <section class="mb-32 bg-gradient-to-r from-purple-900/40 via-transparent to-purple-900/40 py-20">
            <div class="bg-white/10 backdrop-blur-lg rounded-lg p-12 max-w-4xl mx-auto hover:transform hover:scale-105 transition-all duration-300">
                <h2 class="text-3xl font-bold text-white mb-8 text-center">About Our Internship Program</h2>
                <div class="space-y-6 text-gray-200">
                    <p>Join Antarman's internship program to gain hands-on experience in mental health care and counseling. Our program offers:</p>
                    <ul class="list-disc pl-6 space-y-3">
                        <li>Direct exposure to clinical practices and patient care</li>
                        <li>Mentorship from experienced professionals</li>
                        <li>Research opportunities in mental health</li>
                        <li>Duration: 3-6 months</li>
                        <li>Certificate upon successful completion</li>
                    </ul>
                </div>
            </div>
        </section>

        <!-- Image Marquee Section -->
        <section class="mb-32">
            <h2 class="text-3xl font-bold text-white mb-8 text-center">Our Interns at Work</h2>
            <Marquee className="py-4" pauseOnHover={true} client:load>
                {internImages.map((image) => (
                    <div class="w-[300px] h-[200px] mx-4">
                        <img
                            src={image.src}
                            alt={image.alt}
                            class="w-full h-full object-cover rounded-lg hover:scale-105 transition-transform duration-300"
                        />
                    </div>
                ))}
            </Marquee>
        </section>

        <!-- Success Modal -->
        <div id="successModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
            <div id="modalContent" class="bg-white/10 backdrop-blur-lg p-8 rounded-3xl shadow-2xl transform scale-0 transition-transform duration-300">
                <h3 class="text-2xl font-bold text-white mb-4">Thank You for Applying!</h3>
                <p class="text-purple-100 mb-6">We have received your application. Our team will review it and contact you soon regarding the next steps.</p>
                <button id="okayButton" class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full transform transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50">
                    Okay
                </button>
            </div>
        </div>

        <!-- Application Form -->
        <section class="mb-32">
            <div class="max-w-4xl mx-auto">
                <h2 class="text-3xl font-bold text-white mb-8 text-center">Apply Now</h2>
                <form id="internshipForm" class="bg-white/10 backdrop-blur-lg rounded-lg p-8 space-y-6" action="https://docs.google.com/forms/d/e/1FAIpQLSfQBhLI9lDUTX9pUPxGpKqZHHVHhPYWUlqkB6nrcF5P_Fz-Yw/formResponse" method="POST">
                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-200 mb-2" for="firstName">First Name</label>
                            <input 
                                type="text" 
                                id="firstName"
                                name="entry.509267637"
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>
                        <div>
                            <label class="block text-gray-200 mb-2" for="lastName">Last Name</label>
                            <input 
                                type="text" 
                                id="lastName"
                                name="entry.145340154" 
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-200 mb-2" for="email">Email</label>
                            <input 
                                type="email" 
                                id="email"
                                name="entry.1685765782"
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>
                        <div>
                            <label class="block text-gray-200 mb-2" for="phone">Phone Number</label>
                            <input 
                                type="tel" 
                                id="phone"
                                name="entry.34252276"
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>
                    </div>

                    <div class="grid md:grid-cols-2 gap-6">
                        <div>
                            <label class="block text-gray-200 mb-2" for="course">Course</label>
                            <select 
                                id="course"
                                name="entry.931255215"
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500 [&>option]:bg-gray-800"
                                required
                            >
                                <option value="">Select a course</option>
                                <option value="ma-psych-2">MA in Psychology 2nd year</option>
                                <option value="ma-psych-1">MA in Psychology 1st year</option>
                                <option value="msc-psych-2">MSC in Psychology 2nd year</option>
                                <option value="msc-psych-1">MSC in Psychology 1st year</option>
                                <option value="msw">Master in Social Work</option>
                                <option value="ba-psych">BA in Psychology</option>
                                <option value="others">Others</option>
                            </select>
                        </div>
                        <div>
                            <label class="block text-gray-200 mb-2" for="college">Name of College</label>
                            <input 
                                type="text" 
                                id="college"
                                name="entry.286298854"
                                class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                                required
                            />
                        </div>
                    </div>

                    <div>
                        <label class="block text-gray-200 mb-2" for="startDate">Start Date of Internship</label>
                        <input 
                            type="date" 
                            id="startDate"
                            name="entry.27519836"
                            class="w-full bg-white/5 border border-gray-300/20 rounded-lg px-4 py-2 text-white focus:outline-none focus:ring-2 focus:ring-purple-500"
                            required
                        />
                    </div>

                    <div class="text-center">
                        <button 
                            type="submit"
                            class="bg-purple-600 hover:bg-purple-700 text-white font-bold py-2 px-6 rounded-full transform transition-all hover:scale-105 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50"
                        >
                            Submit Application
                        </button>
                    </div>
                </form>
            </div>
        </section>
    </div>
    <Footer />
</Layout>
<script>
    // Google Form field IDs
    const FORM_FIELDS = {
        formUrl: 'https://docs.google.com/forms/d/e/1FAIpQLSfQBhLI9lDUTX9pUPxGpKqZHHVHhPYWUlqkB6nrcF5P_Fz-Yw/formResponse',
        firstName: 'entry.509267637',
        lastName: 'entry.145340154',
        email: 'entry.1685765782',
        phone: 'entry.34252276',
        course: 'entry.931255215',
        college: 'entry.286298854',
        startDate: 'entry.27519836'
    };

    const form = document.getElementById('internshipForm') as HTMLFormElement;
    const modal = document.getElementById('successModal');
    const modalContent = document.getElementById('modalContent');
    const okayButton = document.getElementById('okayButton');

    async function submitToGoogleForm(formData: FormData) {
        try {
            const response = await fetch(FORM_FIELDS.formUrl, {
                method: 'POST',
                mode: 'no-cors',
                body: formData
            });
            return true;
        } catch (error) {
            console.error('Error submitting form:', error);
            return false;
        }
    }

    function formatFormDataForGoogleForm(formData: FormData) {
        const formattedData = new FormData();
        
        formattedData.append(FORM_FIELDS.firstName, formData.get('entry.509267637') as string);
        formattedData.append(FORM_FIELDS.lastName, formData.get('entry.145340154') as string);
        formattedData.append(FORM_FIELDS.email, formData.get('entry.1685765782') as string);
        formattedData.append(FORM_FIELDS.phone, formData.get('entry.34252276') as string);
        formattedData.append(FORM_FIELDS.course, formData.get('entry.931255215') as string);
        formattedData.append(FORM_FIELDS.college, formData.get('entry.286298854') as string);
        formattedData.append(FORM_FIELDS.startDate, formData.get('entry.27519836') as string);

        return formattedData;
    }

    if (form && modal && modalContent && okayButton) {
        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const formData = new FormData(form);
            const success = await submitToGoogleForm(formatFormDataForGoogleForm(formData));

            if (success) {
                modal.classList.remove('hidden');
                setTimeout(() => {
                    modalContent.classList.remove('scale-0');
                    modalContent.classList.add('scale-100');
                }, 100);
            } else {
                // Handle error case
                alert('There was an error submitting your application. Please try again.');
            }
        });

        okayButton.addEventListener('click', () => {
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                form.reset();
            }, 300);
        });
    }
</script>

<style>
    @keyframes fadeIn {
        from { opacity: 0; }
        to { opacity: 1; }
    }

    @keyframes slideUp {
        from { transform: translateY(20px); opacity: 0; }
        to { transform: translateY(0); opacity: 1; }
    }

    .animate-fade-in {
        animation: fadeIn 1s ease-out;
    }

    .animate-slide-up {
        animation: slideUp 1s ease-out;
    }
</style>

<script>
    const form = document.getElementById('internshipForm') as HTMLFormElement;
    const modal = document.getElementById('successModal');
    const modalContent = document.getElementById('modalContent');
    const okayButton = document.getElementById('okayButton');

    if (form && modal && modalContent && okayButton) {
        form.addEventListener('submit', (e) => {
            e.preventDefault();
            modal.classList.remove('hidden');
            setTimeout(() => {
                modalContent.classList.remove('scale-0');
                modalContent.classList.add('scale-100');
            }, 100);
        });

        okayButton.addEventListener('click', () => {
            modalContent.classList.remove('scale-100');
            modalContent.classList.add('scale-0');
            setTimeout(() => {
                modal.classList.add('hidden');
                form.reset();
            }, 300);
        });
    }
</script>